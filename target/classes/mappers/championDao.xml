<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<!-- 에러시 window-preferences-maven검색-Download Artifact javadoc 체크할것 -->
<mapper namespace="com.gg.gop.dao.ChampionDao">

	<select id="allChampion">
		select championId, champion_name, champion_name_kr
		from
		champion_names
	</select>

	<select id="findChampion">
		select * from champion_names where champion_name =
		#{championName}
	</select>


	<!-- Rest -->
	<select id="searchList">
		SELECT champion_name_kr, champion_name
		FROM
		champion_names
		WHERE champion_name_kr like concat('%', #{search}, '%');
	</select>

	<select id="lineChampionList">
		SELECT championName,
		ROUND((COUNT(CASE WHEN
		teamPosition = #{line} THEN gameId END) / COUNT(DISTINCT gameId) *
		100), 1) AS pick_rate
		FROM lol_datas
		GROUP BY championName
		HAVING
		pick_rate > 10
	</select>

	<select id="lineRecode">
		<!-- 전체 출력 -->
		select distinct championName, position, winRate, pickRate, banRate from
		champdata
	</select>

	<select id="lineInfo">
		<!-- 라인 출력 -->
		select distinct championName, position, winRate, pickRate, banRate from
		champdata where position = #{line}
	</select>

	<select id="getChampionRune">
		SELECT * FROM gop_rune
		WHERE championName = #{championName}
		AND teamPosition = #{position}
		AND main_name IN (
		    SELECT main_name 
		    FROM gop_rune
		    WHERE championName = #{championName}
		    GROUP BY main_name
		    HAVING COUNT(*) / (SELECT COUNT(*) FROM gop_rune WHERE championName = #{championName}) * 100 >= 15)
	</select>

	<select id="getChampionPosition">
		SELECT teamPosition FROM gop_rune
		WHERE championName = #{championName}
		GROUP BY teamPosition
		HAVING COUNT(main_name) / (SELECT COUNT(*) FROM gop_rune WHERE championName = #{championName}) * 100 >= 15;
	</select>
	
	<select id="getRates">
		select winRate, pickRate, banRate from champdata 
		where championName = #{championName} and position = #{firstLine};
	</select>
	
	<select id="getSpells">
		SELECT spell1Name, spell2Name, COUNT(*) AS combinationCount
		FROM lol_datas
		WHERE championName = #{championName} AND teamPosition = #{position}
		GROUP BY spell1Name, spell2Name
		ORDER BY combinationCount DESC
		LIMIT 4;
	</select>
</mapper>