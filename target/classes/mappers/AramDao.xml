<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<!-- 에러시 window-preferences-maven검색-Download Artifact javadoc 체크할것 -->
<mapper namespace="com.gg.gop.dao.AramDao">

	<select id="allChampion">
		select championId, champion_name, champion_name_kr from
		champion_names
	</select>

	<select id="findChampion">
		select * from champion_names where champion_name =
		#{championName}
	</select>

	
	<!-- Rest -->
	<select id="searchList">
		SELECT champion_name_kr, champion_name
		FROM
		champlist
		WHERE champion_name_kr like concat('%', #{search}, '%')
		or champion_name like concat('%',#{search},'%')
		or champion_name_cons like concat('%',#{search},'%')
	</select>
	
<!-- 	<select id="lineChampionList"> -->
<!-- 		SELECT championName, -->
<!-- 		ROUND((COUNT(CASE WHEN -->
<!-- 		teamPosition = #{line} THEN gameId END) / COUNT(DISTINCT matchId) * -->
<!-- 		100), 1) AS pick_rate -->
<!-- 		FROM lol_datas -->
<!-- 		GROUP BY championName -->
<!-- 		HAVING pick_rate > 10 -->
<!-- 	</select> -->

	<select id="lineRecode">
<!-- 	전체 출력 -->
		select ar.*, ac.champion_name_kr from aramdata2 ar, aramchampion ac where ar.championName=ac.championName;
	</select>
	
    <select id="getChampionRune">
		SELECT * FROM aram_rune
		WHERE championName = #{championName}
		AND main_name IN (
		    SELECT main_name 
		    FROM aram_rune
		    WHERE championName = #{championName}
		    GROUP BY main_name
		    HAVING COUNT(*) / (SELECT COUNT(*) FROM aram_rune WHERE championName = #{championName}) * 100 >= 15);
	</select>

	
	<select id="getRates">
		select win_rate, pickRate, dpm from aramchampion 
		where championName = #{championName};
	</select>
	
	<select id="getSpells">
	SELECT 
	summoner1Id,
    summoner2Id,
    spell1Id,
    spell2Id,   
    spell1name,
    spell2name,
    COUNT(*) AS playCount,
    ROUND(COUNT(*) / (
		            SELECT COUNT(*)
		            FROM aram
		            WHERE championName = #{championName} 
		        ) * 100, 2) AS pickRate,
		        ROUND((COUNT(CASE WHEN win = 'True' THEN 1 END) / COUNT(*) * 100), 2) AS winRate
	
    FROM 
   ( SELECT     summoner1Id, summoner2Id, spell_list.id AS spell1Id, spell_list2.id AS spell2Id , spell_list.name as spell1name,spell_list2.name as spell2name,
                win
		    FROM aram
		    JOIN spell_list ON aram.summoner1Id = spell_list.spell_id
		    JOIN spell_list AS spell_list2 ON aram.summoner2Id = spell_list2.spell_id
            WHERE championName = #{championName}
			AND summoner1Id > summoner2Id
            ) as subquery

GROUP BY 
    summoner1Id,
    summoner2Id,
    spell1Id,
    spell2Id,
    spell1name,
    spell2name
ORDER BY 
    playCount DESC
    limit 2;
	</select>
	
	<select id="getChampionItem">
		SELECT championName_KR, core1, core2, core3, COUNT(*) AS core3_count,
		    ROUND(COUNT(*) / (
		            SELECT COUNT(*)
		            FROM aram_core1
		            WHERE championName = #{championName} AND core1 != 0 AND core2 != 0 AND core3 != 0
		        ) * 100, 2) AS core3_percentage,
		    ROUND((COUNT(CASE WHEN win = 'True' THEN 1 END) / COUNT(*) * 100), 2) AS core3_win_percentage
		FROM aram_core1
		WHERE
		    championName = #{championName}     
		    AND core1 != 0 AND core2 != 0 AND core3 != 0 and core1 != core2 and core2 != core3 and core1 != core3
		GROUP BY
		    championName_KR, core1, core2, core3
		Having core3_win_percentage != 0
		ORDER BY
		    core3_count DESC
		LIMIT 3;
	</select>
</mapper>